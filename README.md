# Amplicon_MiSeq_V4
updated version of my pipeline using the v4 primers for eukaryotic SSU and running on a linux server.


# Amplicon_MiSeq_pipeline
This repository contains scripts and use PR2 database to analyse MiSeq data for Amplicon generate with eukaryotic V4 SSU primers.

# Pipeline Guide for eukV4SSU

A whole pipeline (scripts and folders structure) for MiSeq analysis.

Prepare your data and folders:

0- keep the same folders and files structure from the repository or the scripts will crash!

1- Create a folder named Rawdata with all your MiSeq sequence files (e.g. HTS1_test1_S1_L001_R1.fastq.gz, HTS1_test1_S1_L001_R2.fastq.gz)

	You can use the script movefile.py to create this folder

2- Create a file with your sample code and sample name (there should be a file named List_samples.txt containing: RWS## (tab) samplename ) \n '

	You can use excel to create this file and save as a Tab Delimited Text (.txt) file
	
	So far, the List_samples.txt file includes all the samples generated by the Katzlab. Delete the samples you are not interested in.
	example of list: 

		HTS1	test1
	
		HTS2	test2
	
		HTS3	test3

Note: the first element is a part of name of the file generated from HTS and the second is the name you want the sample to be labelled
	
3- Copy the script folder, SAR_db folder and the 3 scripts named MiSeq_pipeline_V4_SWARM_part(1,2 and 3)_HPC.py from this repository and add all in the folder where you save the samplelist.txt and the rawdata folder (suggestion MiSeq_folder).

4- primer file in SAR_db folder. add a fasta file with your primers such as: 

	'>'V4_f
	
	ACTCAGGGAGGTAGTGACAAG
	
	'>'SAR2_f
	
	ATTCAGGGAGGTAGTGACAAG
	
	'>'SAR1_r
	
	GCAGTTAAAAAGCTCGTAGTC
	
	'>'SAR2_r
	
	GCAGTTAAAAAGCTCGTAGTT

Note: if you have degenerated bases, you should add the various combination as the script do not do it for you. (remove the ' to create your file)
**IMPORTANT: the name of the primer must be as following: text_r or text_f. r and f for reverse and forward and text should not contain any underscores.**

~~4- Open the script 6 (in Miseq_scripts folder, named 6_BLASTn_v2.py).~~ Not use anymore: BLAST is replaced by vsearch for efficiency purpose.

	Replace the XXX by the email address you are using for your NCBI account => Entrez.email = "XXX@xx.xx"
	
	If you don't an NCBI account, you should create one by going to this ncbi webpage (https://www.ncbi.nlm.nih.gov/account/register/?back_url=https%3A%2F%2Fwww.ncbi.nlm.nih.gov%2Fbioproject&partners-uri=cms:/account/partners)

More description available in Guide_MiSeqPipeline_2018.txt.

An undergraduate proofread guide can be shared on request.

# Amplicon_MiSeq_pipeline for other lineages
This set of scripts can be edited to use another set of primers/taxa.

part 1: Do not forget to update PEAR parameters in MiSeq_pipeline_SAR_SWARM_part1.py (see here for parameters https://sco.h-its.org/exelixis/web/software/pear/doc.html)

part2: build your database folder (see https://github.com/jeandavidgrattepanche/SSU_DataBase_builiding for scripts and more information) and replacing the database in the script MiSeq_pipeline_SAR_SWARM_part2.py and script 6 (look for SAR_db and replace by the corresponding files). 

Where to update your reference database:
- MiSeq_pipeline_SAR_SWARM_part2.py lines 61, 62, 66, 68, 69 and 73 

	*61 and 68: replace file after '--mapout' by your reference sequence alignment
	
	*62 and 69: replace the last argument by your list of column with missing data
	
	*66 and 73: replace the "-t" argument by your reference tree
	
- script 6: line 15 

	line 15: replace the SAR_db value by your db e.g. the PR2database (do not forget to add the database folder)


Create also your primer file. **IMPORTANT: the name of the primer must be as following: text_r or text_f. r and f for reverse and forward and text should not contain any underscores.** see above for more details


